<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Class Performance Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f5f7fa;
    }

    h1 {
      text-align: center;
      margin-bottom: 40px;
    }

    .chart-container {
      max-width: 900px;
      margin: 40px auto;
      background: #ffffff;
      padding: 20px;
      border-radius: 8px;
    }
  </style>
</head>

<body>

  <h1>Class Performance Dashboard</h1>

  <div class="chart-container">
    <h2>Subject Averages</h2>
    <canvas id="avgChart"></canvas>
  </div>

  <div class="chart-container">
    <h2>Above vs Below Average (Per Subject)</h2>
    <canvas id="aboveBelowChart"></canvas>
  </div>

  <div class="chart-container">
    <h2>Student Strengths & Weaknesses (John)</h2>
    <canvas id="radarChart"></canvas>
  </div>


 <!-- Chart.js CDN -->
 <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

 <script>
    fetch("./output/dashboardData.json")
      .then((res) => res.json())
      .then((data) => {
        console.log("✅ Dashboard data loaded:", data);
  
        // ✅ Support either key name (subjectStats OR subjectStatistics)
        const subjectStats = data.subjectStats || data.subjectStatistics;
  
        if (!subjectStats || !Array.isArray(subjectStats)) {
          console.error("subjectStats data missing or not an array:", subjectStats);
          return;
        }
  
        const labels = subjectStats.map((s) => s.subject);
        const averages = subjectStats.map((s) => s.avg);
  
        const avgCtx = document.getElementById("avgChart");
        new Chart(avgCtx, {
          type: "bar",
          data: {
            labels,
            datasets: [
              {
                label: "Average Marks",
                data: averages
              }
            ]
          },
          options: {
            responsive: true,
            scales: {
              y: { beginAtZero: true }
            }
          }
        });

  // -------- Graph 2: Above vs Below (Stacked) --------
  const above = subjectStats.map((s) => s.aboveAvg);
      const below = subjectStats.map((s) => s.belowAvg);
      const equal = subjectStats.map((s) => s.equalAvg);

      const ctx2 = document.getElementById("aboveBelowChart");
      new Chart(ctx2, {
        type: "bar",
        data: {
          labels,
          datasets: [
            { label: "Above Avg", data: above, stack: "s1" },
            { label: "Below Avg", data: below, stack: "s1" },
            { label: "Equal Avg", data: equal, stack: "s1" }
          ]
        },
        options: {
          responsive: true,
          scales: {
            x: { stacked: true },
            y: { stacked: true, beginAtZero: true }
          }
        }
      });


      // -------- Graph 3: Student Comparison (Radar) --------
const comparisons = data.studentComparisons;
if (!comparisons || !Array.isArray(comparisons) || comparisons.length === 0) {
  console.error("studentComparisons missing/empty:", comparisons);
  return;
}

const john = comparisons[0]; // first student (John)
const comparisonMap = john.comparison; // { Maths: "above average", ... }

// Use the same subject order as the charts
const radarLabels = labels;

// Convert text -> number
const radarValues = radarLabels.map((subj) => {
  const status = comparisonMap[subj];

  if (status === "above average") return 1;
  if (status === "equal to average" || status === "equal average") return 0;
  if (status === "below average") return -1;

  return 0; // fallback if missing
});

const radarCtx = document.getElementById("radarChart");

new Chart(radarCtx, {
  type: "radar",
  data: {
    labels: radarLabels,
    datasets: [
      {
        label: `${john.studentName} vs Class Avg`,
        data: radarValues
      }
    ]
  },
  options: {
    responsive: true,
    scales: {
      r: {
        min: -1,
        max: 1,
        ticks: { stepSize: 1 }
      }
    }
  }
});



      })
      .catch((err) => {
        console.error("Failed to load dashboardData.json:", err);
      });




  </script>
  
  
</body>
</html>
